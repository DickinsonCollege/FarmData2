<html>
<head>
  <title>Crop Picker Component Testing</title>
</head>

<body>

<div id="app">
  <field-or-crop-dropdown :drop-down-list="cropsList" includes-all data-cy="crop-picker-component">Select a crop:</field-or-crop-dropdown>
  

  <crop-picker :drop-down-list="cropsList">backup:</crop-picker>
</div>

  <script src="https://unpkg.com/vue"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  <script>

    let CropPickerComponent = {
      template: `<div>
        <label for="crops"><slot></slot></label>
        <input list="crops" v-model="selectedCrop" data-cy="crop-picker-input" @change="cropChanged">
            <datalist id="crops" data-cy="crop-picker-dropdown">
                <option v-for="crop in fullDropDown" data-cy="crop-picker-options">{{ crop }}</option>
            </datalist>
        </div>`,
      props: {
        inField: {
          type: String
        },
        dropDownList: {
          type: Array
        },
        includesAll: {
          type: Boolean,
        },
      },
      data() {
        return {
          selectedCrop: null,
        }
      },
      methods: {
        cropChanged() {
            this.$emit('cropChanged', this.selectedCrop)
        }
      },
      computed: {
        fullDropDown: function() {
          let newList = this.dropDownList;
          if (this.includesAll == true) {
              newList.splice(0,0,"All");
          }
          return newList;
        }
      }
    }

    let FieldPickerComponent = {
      template: `<div>
        <label for="fields"><slot></slot></label>
        <input list="fields" v-model="selectedField" data-cy="field-picker-input">
            <datalist id="fields" data-cy="field-picker-dropdown">
                <option v-for="field in fullDropDown">{{ field }}</option>
            </datalist>
        </div>`,
      props: {
        includesAll: {
          type: Boolean
        },
        forCrop: {
          type: String
        },
        dropDownList: {
          type: Array
        }
      },
      data() {
        return {
          selectedField: null
        }
      },
      computed: {
        fullDropDown: function() {
          let newList = this.dropDownList;
          if (this.includesAll == true) {
              newList.splice(0,0,"All");
          }
          return newList;
        }
      }
    }

    new Vue({
      el: '#app',
      components: {
        'field-or-crop-dropdown': FieldOrCropDropdownComponent,
        'crop-picker': CropPickerComponent,
      },
      data() {
          return {
            cropsList: [],
            fieldsList: []
          }
      },
      created() {
            /**
             * axios.get('/farm_asset.json?type=planting').then(response => {
                this.cropsList = response.data.list.map(f => f.name).sort();
            });
            axios.get('/taxonomy_term.json?bundle=farm_areas').then(response => {
                this.fieldsList = response.data.list.map(f => f.name).sort();
            });
            */

            //The lines below are added for the sake of testing
            this.cropsList = ['Corn', 'Beans', 'Peas'];
            this.fieldsList = ['Chuau', 'Jasmine-1', 'O'];
            
      }
    })
  </script>


</body>
</html>
