<html>
    
<body>
    <h1>Harvest Report</h1>
    <br>
    <p>This page is a <i>mockup</i> of a form for generating a harvest
    	report</p>
    <div id="report-bind" v-cloak>
    <label for="title">Title:</label>
    <input type="text" id="title" v-model="rptTitle">
    <br><br>
    <label for="start">Start:</label>
    <input type="date" id="start" min="2014-01-01" :max="rptEnd" 
    v-model="rptStart"> 
    <label for="end">End:</label>
    <input type="date" id="end" :min="rptStart" max="2022-01-01" 
    v-model="rptEnd">
    <br><br>
    <label for="crop-search">Crop:</label>
    <select id="crop-search" v-model="rptCrop"> 
        <option v-for="crop in crops" >{{crop}}</option>
    </select>
    <label for="field-search">Field:</label>
     <select id="field-search">
        <option v-for="field in fields" >{{field}}</option>
    </select>
    <br><br>
    <button type="button" class="btn btn-primary" @click="generateBtn" 	id="generate-report">Generate Report</button>
    <hr>
   
    <div v-if="state=='visible'">
    <h1>{{rptTitle ? rptTitle: 'Mock Harvest Report'}}</h1>
    <p>Details:</p>
    <ul>
        <li><b>Start: {{rptStart}}</b></li>
        <li><b>End: {{rptEnd}}</b></li>
        <li><b>Crop: {{rptCrop}}</b></li>
    </ul>
     <p v-if="harvestLog.length == 0">No matching records</p>
     <table border=1 v-else>
        <tr>
            <th>Date</th>
            <th>Field</th>
            <th>Crop</th>
            <th>Yield</th>
        </tr>
        <tr v-for="(log,index) in harvestLog">
            <td>{{log.Date}}</td>
            <td>{{log.Field}}</td>
            <td>{{log.Crop}}</td>
            <td>{{log.Yield}}</td>
            <td><button type="button"  @click="deleteLog(index)">Delete 
            </button></td>
        </tr>
    </table> 
    <p>Total Yield: {{totalYield}} BUNCH(s)</p>
    </div>

    </div>
<script>
    var reportVue = new Vue({
        el: '#report-bind',
        data: {
        rptTitle: '',
        rptStart:'',
        rptEnd:'',
        rptCrop:'',
        state:'inVisible',
        crops: ['Broccoli', 'Kale', 'Peas'],
        fields: [],
        harvestLog:[],
        HLog:[ {Date: '05/02/2018', Field: 'SQ7', Crop:'Kale', 
        Yield: '10 Bunches'},
        {Date: '09/02/2018', Field: 'All', Crop:'Broccoli', 
        Yield: '7 Bunches'},
        {Date: '11/02/2018', Field: 'SQ7', Crop:'Peas', 
        Yield: '10 Bunches'}
        ]
        },
         computed: {
            totalYield: function(){
                var total = 0;
                for(let i = 0; i < this.harvestLog.length; i++){
                let yield = parseInt(this.harvestLog[i].Yield.split(" ")
                [0]);
                total = total + yield;
                }
                return total;
            }
        },


        methods:{
            generateBtn: function(){
                if(this.harvestLog.length < 3){
                    if(this.harvestLog.length ==0){
                        this.state='visible';
                    }
                    this.harvestLog.push(this.HLog[this.harvestLog.length])
                }
            },
            deleteLog: function(index){
                this.harvestLog.splice(index,1);
            }

        },
        created(){
            axios.get('/taxonomy_term.json?area_type=field')
                .then(response => {
            this.fields = response.data.list.map(f => f.name).sort();
            })

        },
    
        
    });
    Vue.config.devtools = true;
</script>
</body>
</html>
