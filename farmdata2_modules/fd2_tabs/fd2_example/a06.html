<head>
    <h1>Harvest Report</h1>
</head>
<br>
<body>
    <p>This page is a <i>mockup</i> of a form for generating a harvest report.</p>
<div id="harvest-report" v-cloak>
    <label for = "title">Title:</label>
    <input type=”text” id=”title” value=”title” v-model="header">
<br>
<br>
    <label for="start">Start date:</label>

    <input type="date" id="start" name="start"
       v-model="StartDate"
       min="2014-01-01" max="2022-01-01" :max="EndDate">       
    <label for="end">End date:</label>

    <input type="date" id="end" name="end"
       v-model="EndDate"
       min="2018-05-01" max="2022-01-01" :min="StartDate">
<br>
<br>
    <label for = "simple">Crop:</label>
<select id="simple" name="simple" v-model= "rptCrop">
<ul>
     <option v-for="crop in crops">{{ crop }}</option>
 </ul>
</select>
    <label for = "simple">Field:</label>
 <select id="simple" name="simple" v-model="rptField">
 <ul>
    <option v-for="field in fields">{{ field }}<option>
</ul>
</select>

<br>
<br>

<button class="button" @click="saveRpt" >
    Generate Report
</button>

<div v-if="state === 'edit'">
<hr>
    <h1>{{ header=="" ? "Mock Harvest Report" : header }}</h1>
<br>
    <p>Details:
        <ul>
            <li><strong>Start:</strong>{{ StartDate }}</li>
            <li><strong>End:</strong>{{ EndDate }}</li>
            <li><strong>Crop:</strong>{{ rptCrop }}</li>
    </ul>
</p>
<br>
<br>
<table border="1" v-if="hlogs.length > 0">
<tr>
    <th>Date</th>
    <th>Field</th>
    <th>Crop</th>
    <th>Yield</th>
    <th>Delete</th>
</tr>
<tr v-for=" (hlog,index) in hlogs" >
    <td >{{hlog.date}}</td>
    <td >{{ hlog.field }}</td>
    <td >{{ hlog.crop }}</td>
    <td >{{ hlog.yeild }}</td>
    <td><button type="button" @click="hlogs.splice(index,1)">Delete</button></td>
</tr>
</table>
<p v-if="hlogs.length === 0">No matching records.</p>
<br>
<br>
<!--
<p>{{"Total Yeild: " + totalYeild}}</p>
--->
</div>
</div>

 <script>
	var databinding = new Vue({
		el: "#harvest-report",
		data: {
                state: "default",
                header: "Mock Harvest Report",
                StartDate: "2018-05-01",
                EndDate: "2018-05-15",
                rptCrop: "Kale",
                rptField:"Chuau-1",
                newHlog: {date: "", field: "", crop: "", yeild: "10 Bunches"},
                crops: [],
                 fields: [],
                 hlogs : [
                 ],
                 harvestLogs: []
        },
       
        methods: {
             saveRpt: function() {
            if (this.hlogs.length == 0) {
               this.hlogs.push(this.harvestLogs[0]);
               this.state = 'edit';
            } else if (this.hlogs.length == 1){
                this.hlogs.push(this.harvestLogs[1]);
            } else if (this.hlogs.length == 2){
                this.hlogs.push(this.harvestLogs[2]);
            }else if (this.hlogs.length == 3){
                this.hlogs.push(this.harvestLogs[3]);
            }
     },
     timestampToDate: function(timestamp) {
           const dt = new Date(timestamp *1000);
			return dt;

          },
     timestampToYMD: function(timestamp) {
		let d = this.timestampToDate(timestamp);
		const month = d.getMonth() < 9 ?
							 '0' + (d.getMonth() + 1) :
							 d.getMonth() + 1;
		const day = d.getDate() < 10 ?
						  '0' + d.getDate() :
							d.getDate();
		return d.getFullYear() + "-" + month + "-" + day;
	},
    },
    	created() {
    axios.get('/taxonomy_term.json?area_type=field')
     .then(response => {
        this.fields = response.data.list.map(f => f.name).sort();
     })
     .catch(error => {
       this.fields = ["Service Unavailable"];
       console.log(error);
     });
     axios.get('/farm_asset.json?type=planting')
     .then(response => {
        this.crops = response.data.list.map(f => f.name).sort();
     })
     .catch(error => {
       this.crops = ["Service Unavailable"];
       console.log(error);
     });
     axios.get('/log.json?type=farm_harvest&area=Jasmine-1')
     .then(response => {
		this.harvestLogs = response.data.list.map(h => {
			return {
				date: this.timestampToYMD(h.timestamp), 
				field:'blah', 
				crop:'blah', 
				yield:'blah',
			};
		});
	})
 },

});
Vue.config.devtools = true;
</script>
</body>