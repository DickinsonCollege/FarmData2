<head>
    <h1>Tray Seeding Report</h1>
</head> 
<body>
    <div id= "tray-seeding-report" v-cloak>
        <label for = "cropList">Crop:</label>
        <select id= "cropList" name = "simple" v-model="rptCrop">
            <ul>
                <option v-for="crop in crops">{{ crop }}</option>
            </ul>
        </select>
    <br>
        <label for="start">Start Date:</label>
        <input type="date" id="start" name="start" v-model="reportStart" min="2014-01-01" :max="reportEnd">

        <label for="end">End Date:</label>
        <input type="date" id="end" name="end" v-model="reportEnd" :min="reportStart" max="2022-01-01">
    <br>
        <button class="btn btn-primary" @click="generateReport">Generate Report</button>


    <div v-if="state === 'edit'">
        <hr />
        <h2>Mock Report</h2>
        <br>
        <ul>
            <li><strong>Start:</strong>{{reportStart}}</li>
            <li><strong>End:</strong>{{reportEnd}}</li>
            <li><strong>Crop:</strong>{{rptCrop}}</li>
        </ul>

        <br>
        <table border=1>
        <tr>
            <th>  Date of Seeding  </th>
            <th>  Crop  </th>
            <th>  Number of Seeds  </th>
            <th>  Number of Trays  </th>
            <th>  Cells per Tray  </th>
            <th>  Variety  </th>
            <th>  User  </th>
            <th>  Comments  </th>
        </tr>

        <tr v-for=" (hlog,index) in hlogs">
            <td> {{hlog.date}}  </td>
            <td>{{ hlog.crop }}</td>
            <td>     </td>
            <td>     </td>
            <td>     </td>
            <td>     </td>
            <td>     </td>
            <td>     </td>
        </tr>
        </table>
    </div>
    </div>
    <script>
        var databinding = new Vue({
            el: '#tray-seeding-report',
            data: {
                state: "default",
                crops: [],
                rptCrop: "Kale",
                reportStart: '2018-05-01',
                reportEnd: '2018-07-31',
                hlogs: [],
            },
            methods: { 
                timestampToYMD: function(timestamp) {
                    let d = this.timestampToDate(timestamp);
                    const month = d.getMonth() < 9 ?
                                     '0' + (d.getMonth() + 1) :
                                    d.getMonth() + 1;
                    const day = d.getDate() < 10 ?
                                '0' + d.getDate() :
                                d.getDate();
                    return d.getFullYear() + "-" + month + "-" + day;
                }, 
                generateReport: function() {
                    //Need to push number of seeds, trays, cells/Tray, etc. in addition to the date and crop in hlogs array
                    //also need to get all info from farmOS API and not have it hard coded like this. probably by using a for loop with a created function (axios) with a spedificed planting crop in the URL
                if (this.hlogs.length == 0) {
                    this.hlogs.push({date: this.reportStart, crop: this.rptCrop});
                    this.state = 'edit';
                    } else if (this.hlogs.length == 1){
                        this.hlogs.push({date: this.reportStart,crop: this.rptCrop});
                    } else if (this.hlogs.length == 2){
                        this.hlogs.push({date: this.reportStart, crop: this.rptCrop});
                    }else if (this.hlogs.length == 3){
                         this.hlogs.push({date: this.reportStart, crop: this.rptCrop});
                     }
                },
             },
            created() {
                //let today = new Date.now();
                //this.reportEnd = this.timestampToYMD(today);

                axios.get('/farm_asset.json?type=planting').then(response => {
                    this.crops = response.data.list.map(f => f.name).sort();
                    this.crops.splice(0,0,"All");
                });
              // push all into crops array, make sure it goes to the top. Just incert on the top.
              // once i get generate reort report, then get the API request to call all the crops.
              // Make a API request, make sure to filter out the right things

                let today = new Date.now();
                this.reportEnd = this.timestampToYMD(today);
            }
        });
       Vue.config.devtools = true;
    </script>
</body>