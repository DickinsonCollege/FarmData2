
<!DOCTYPE html>
<div id="vue-tab">

<html>
    <head>
        <meta charset="utf-8">
        <title>My test page</title>
    </head>
    <body>
        <h1>Harvest Report</h1>
        <p>This page is a <i>mockup</i> of a simplified harvest report</p>
        <label for="title">Title:</label>
        <input type="text" v-model="reportTitle" value=""/>
        
        <br/>
        <br/>
        <label for="start">Start Date</label>
        <input type="date" id="start" value="2020-05-05" min="2014-01-01" max="2022-01-01">
        <label for="end">End Date</label>
        <input type="date" id="end" value="2020-05-15" min="2020-05-05" max="2022-01-01">

        <br/>
        <br/>
                
        <label for="crop">Crop</label>

        <select id="crop" name="crop">
            <option v-for="crop in cropsData">{{crop}}</option>
        </select>
        
        <label for="field">Field</label>

        <select id="field" name="field">
            <option v-for="field in areasData">{{field}}</option>
        </select>
        
        <br />
        <br />

        <button @click="makeRequest">Generate Report</button>

        <hr>
        <div id="report-Title">
            <h1>{{ reportTitle ? reportTitle : "Mock Harvest Report"}}</h1>
        </div>
        <p>Details:</p>
        <ul>
            <li v-model="farm"><strong>Farm</strong>:{{farm}}</li>
            <li v-model="user"><strong>User</strong>:{{user}}</li>
            <li v-model="language"><strong>Language</strong>:{{language}}</li>
        </ul>
        <br>
        <ul>
            <li v-bind:max="reportEndDate" v-model="reportStartDate"><strong>Start</strong>:{{reportStartDate}}</li>
            <li v-bind:min="reportStartDate" v-model="reportEndDate"><strong>End</strong>:{{reportEndDate}}</li>
            <li v-model="reportCrop"><strong>Crop</strong>:{{reportCrop}}</li>
        </ul>
        

        <table border=1>
            <tr v-if="harvestLogs.length !== 0">
                <th>Row</th>
                <th>Date</th>
                <th>Area</th>
                <th>Crop</th>
                <th>Yield</th>
                <th>Units</th>
            </tr>
            <tr v-for="(log, index) in harvestLogs">
                <td>{{index + 1}}</td>
                <td>{{log.date}}</td>
                <td>{{log.area}}</td>
                <td>{{log.crop}}</td>
                <td>{{log.yield}}</td>
                <td>{{log.units}}</td>

            </tr>
        </table>
        <h1 v-if="harvestLogs.length === 0">No matching records</h1>

    </body>
</html>
</div>

<script>
            var data = new Vue({
                el: "#vue-tab",

                created() {
                    console.log("HarvestReport created!")
                    getIDToCropMap()
                    .then((theMap) => {
                        this.idToCropMap = theMap
                        console.log("Worl")
                    })
                    .catch((err) => {
                        console.log("Error occurred")
                    }),

                    getIDToAreaMap()
                    .then((theMap) => {
                        this.idToAreaMap = theMap
                    })
                    .catch((err) => {
                        console.log("Error occurred")
                    })
                },

                data: {
                    reportTitle: "My Sample Harvest Report",
                    reportStartDate: "05/05/2020",
                    reportEndDate: "05/15/2020",
                    reportCrop: "Kale",
                    fields: ["All", "Chuau-1", "SQ7"],
                    newItem: {date: '05/01/2018', area: 'Orion-3', crop: 'Kale', yield: '12', units: 'bunches'},
                    harvestLogs: [],
                    farm: "",
                    user: "",
                    language: "",
                    idToCropMap: [],
                    idToAreaMap: [],
                    result: []
                },

                computed: {
                    cropsData() {
                        return this.idToCropMap.values()
                    },
                    areasData() {
                        return this.idToAreaMap.values()
                    }
                },

                methods: {
                    addHarvestLog: function() {
                        this.harvestLogs.push(this.newItem)
                    },
                    changeValue: function() {
                        this.farm = "Sample Farm",
                        this.user = "manager1",
                        this.language = "English"
                    },
                    makeRequest: function() {
                        let start_timestamp = dayjs(this.reportStartDate).unix()
                        let end_timestamp = dayjs(this.reportEndDate).unix()
                        console.log(start_timestamp, end_timestamp)
                        
                        let query = "/log.json?type=farm_harvest&timestamp[ge]=" + start_timestamp + "&timestamp[le]=" + end_timestamp

                        getAllPages(query, this.result)
                                .then(() => {
                                })
                                .catch((err) => {
                                    // An error occured during the requests, process it here.
                                })
                        axios.get('/farm.json')  // this line sends the request.
                            .then((response) => {
                                
                                
                                console.log(query)
                                console.log(response)
                                
                                this.farm = response.data.name
                                this.user = response.data.user.name
                                this.language = response.data.languages.en.name
                            })
                        .catch((error) => {
                            console.log("Error Occurred")
                            console.log(error)
                        })
                        
                    }
                }
            });
            Vue.config.devtools = true;
</script>