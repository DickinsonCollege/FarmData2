<!DOCTYPE html>
<html>
	<head>
        <div id="harvestReport">
        <meta charset="utf-8">
        <body>
		<h1>Harvest Report</h1>
			<p>This page is a <i>mockup</i> of a simplified harvest report.</p>
            <label for="title">Title:</label>
            <input type="text" v-model="header" placeholder="My Mock Harvest Report"><br><br>
            <label for="StartDate">Start: </label>
            <input v-model="startDate" type="date" min="2014-01-01" max="2022-01-01" :max="endDate">
            <label for="EndDate">    End: </label>
            <input v-model="endDate" type="date" min="2014-01-01" max="2022-01-01" :min="startDate"><br><br>
            
			<label for="cropSelectBox">Crop: </label>
			<select v-model="cropSelection" name="crops">
                <option v-for="cropNameArrs in cropNameArr"> {{ cropNameArrs }} </option>
			</select>  
            <label for="fieldSelectBox">Area: </label>
            <select v-model="fieldSelection" name="fields">
                <option v-for="areaNameArrs in areaNameArr"> {{ areaNameArrs }} </option>
            </select><br><br>
            
            <button class="btn btn-primary" @click="addHarvestLog">Generate Report</button>
			<h1>{{ header.length == 0 ? "Mock Harvest Report" : header }}</h1>
				<p>Details:</p>
					<ul>
						<li><strong>Farm: </strong>{{ Farm }}</li>
						<li><strong>User: </strong>{{ User }}</li>
						<li><strong>Language: </strong>{{ Language }}</li><br>
						<li><strong>Start: </strong>{{ startDate }}</li>
                        <li><strong>End: </strong>{{ endDate }}</li>
                        <li><strong>Crop: </strong>{{ cropSelection }}</li><br><br>
                        
			<table border=2>
				<tr v-if= "harvestLog.length > 0">
                    <td><strong> Row </strong></td>
					<td><strong> Date </strong></td>
					<td><strong> Area </strong></td>
					<td><strong> Crop </strong></td>
					<td><strong> Yield </strong></td>
					<td><strong> Units </storng></td>
				</tr>
					<tr v-for="(harvestLogs, index) in harvestLog" v-if=>
                    <td> {{ index + 1 }}</td>
					<td> {{ harvestLogs.date }} </td>
					<td> {{ harvestLogs.field }} </td>
					<td> {{ harvestLogs.crop }} </td>
					<td> {{ harvestLogs.yield }} </td>
					<td> {{ harvestLogs.units }} </td>
				</tr>
              </table>


              </body>
              </div>

              <script>
                  var harvest_Report = new Vue ({
                    el: '#harvestReport',
                    data: {
                    header: '',
                    Farm: '',
                    User: '',
                    Language: '',
                    startDate: '2020-05-05',
                    endDate: '2020-05-15',
                    cropSelection: 'Kale',
                    fieldSelection: 'All',
                    crop: [],
                    field: ['All', 'Chuau-1', 'SQ7'],
                    
                    cropMap: [],
                    areaMap: [],
                    harLogsArr: [],

                    harvestLog: [
                ],
                    row: 
                        {date: '05/01/2018', field: 'Orion-3', crop: 'Kale', yield: '12', units: 'Bunches'},
                  },

                  created() {
                    console.log("HarvestReport created!");
                    getIDToCropMap()
                    .then((theMap) => {
                            A:  console.log("Got Response: getIDToCropMap success");
                                console.log(theMap);
                                this.cropMap = theMap;
                    })
                    .catch((err) => {
                            B:  console.log("Error Occurred: getIDToCropMap failed");
                                console.log(err);
                    }),

                    getIDToAreaMap()
                    .then((getAreaMap) => {
                            A:  console.log("Got Response: getIDToAreaMap success");
                                console.log(getAreaMap);
                                this.areaMap = getAreaMap;
                    })
                    .catch((err) => {
                            B:  console.log("Error Occurred: getIDToAreapMap failed");
                                console.log(err);
                    })
                  },

                computed: {
                    cropNameArr(){
                        return Array.from(this.cropMap.values());
                    },

                    areaNameArr(){
                        return Array.from(this.areaMap.values());
                    }
                },

                  methods: {
                      addHarvestLog: function() {

                        axios.get('/farm.json')
                        .then((response) => {
                            A:  console.log("Got Response");
                                console.log(response);
                                this.Farm=response.data.name;
                                this.User=response.data.user.name;
                                this.Language=response.data.user.language;

                        })
                        .catch((error) => {
                            B:  console.log("Error Occurred");
                                console.log(response);
                        })
                        C:  this.harvestLog.push(this.row);
                            let stDate_timestamp = dayjs(this.startDate).unix();
                            let endDate_timestamp = dayjs(this.endDate).unix();
                            console.log(stDate_timestamp);
                            console.log(endDate_timestamp);
                            dateAPIStr = '/log.json?type=farm_harvest&timestamp[ge]=' + stDate_timestamp + '&timestamp[le]=' + endDate_timestamp;
                            console.log(dateAPIStr);

                        // Assumes that result is an existing array
                        getAllPages(dateAPIStr, this.harLogsArr)
                        .then(() => {
                        console.log('getAllPages request completed successfully')
                        })
                        .catch((err) => {
                        console.log('getAllPages request failed');
                        console.log(err);
                        })

                      },
                  }
                
                  });

                  Vue.config.devtools = true;
              </script>
	</head>
</html>
